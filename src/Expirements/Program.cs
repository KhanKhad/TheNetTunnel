using System;
using System.Diagnostics;
using System.Net.Sockets;
using System.Threading;
using Expirements.General;
using TNT.Channel;
using TNT.Cord;
using TNT.Cord.Deserializers;
using TNT.Cord.Serializers;
using TNT.Light;
using TNT.Light.Sending;
using TNT.Presentation;
using TNT.Presentation.Proxy;

namespace Expirements
{
    class Program
    {
        public static string MSG { get; set; }

        static void Main(string[] args)
        {
            Console.WriteLine("Experiments client");
            //var dispatcher =  new ConveyorDispatcher();
            //var sendSeparationBehaviour = new FIFOSendMessageSequenceBehaviour();
            TcpClient client = new TcpClient();
            //var tcpChannel = new TcpChannel(client);
            //var channel = new LightChannel(tcpChannel, sendSeparationBehaviour, dispatcher);
            //channel.OnDisconnect+= ChannelOnOnDisconnect;

            //Thread.Sleep(1000);
            client.Connect("127.0.0.1", 17171);
            var contract = Factory.CreateForClient(client);
            Stopwatch sw = new Stopwatch();
            int limit = 100000;
            contract.SayCallBack += (s) =>
            {
                if (s == limit)
                {
                    sw.Stop();
                    Console.WriteLine("Elasped: " + sw.ElapsedMilliseconds);
                }
            };
            //var messenger = new CordMessenger(
            //    channel,
            //    SerializerFactory.CreateDefault(),
            //    DeserializerFactory.CreateDefault(),
            //    outputMessages: new[]
            //    {
            //        new MessageTypeInfo
            //        {
            //            ArgumentTypes = new[] {typeof(DateTime), typeof(string), typeof(string)},
            //            messageId = 42,
            //            ReturnType = typeof(string)
            //        }
            //    },
            //    inputMessages: new MessageTypeInfo[0]
            //);

            //var interlocutor = new CordInterlocutor(messenger);
            //var contract = ProxyContractFactory.CreateProxyContract<ITestContract>(interlocutor);
            ////messenger.OnAns += Messenger_OnAns;
            //channel.AllowReceive = true;

           
                string msg;

                msg = GetMessage(); //Console.ReadLine();

                Console.WriteLine($"String lenght {msg.Length}");

                if (msg == "exit")
                {
                    return;
                }

            // messenger.Ask(42, 115, new object[] { DateTime.Now, "Client", msg });
            //var ans = interlocutor.Ask<string>(42, new object[] {DateTime.Now, "Client", msg});

            while (true)
            {
                sw.Reset();
                sw.Start();

                string ans = null;
                for (int i = 0; i <= limit; i++)
                {
                    contract.Say(i);
                }
                Console.ReadLine();
            }

        }

        private static void Messenger_OnAns(ICordMessenger arg1, int msgId, int askId, object result)
        {
            Console.WriteLine($"Answer msgId={msgId} askId={askId} result = {result}");
        }

        private static void ChannelOnOnDisconnect(LightChannel lightChannel)
        {
            Console.WriteLine("Disconnected!!");
        }

        private static string GetMessage()
        {
            return "Главный герой романа Родион Романович Раскольников несколько месяцев назад бросил университет. Он очень беден, ходит в лохмотьях, живет в убогой каморке, но и за нее нечем платить, приходится прятаться от квартирной хозяйки. Дело происходит летом, страшная духота усугубляет тяжелое нервное состояние юноши. Раскольников идет к ростовщице взять денег под залог. Но это не единственная его цель. В голове его зреет план, он мысленно и душевно готовится к его реализации. Он уже знает даже, сколько шагов отделяют его дом от дома ростовщицы; он отмечает про себя, что его изношенная шляпа слишком приметна, надо ее заменить; поднимаясь по лестнице к квартире процентщицы, он видит, что на ее этаже освобождается квартира, стало быть, останется только одна занятая... Старуха-процентщица, Алена Ивановна, живет в двухкомнатной квартире вместе со своей младшей сестрой Лизаветой, существом забитым и бессловесным. Лизавета “поминутно ходит беременная”, день и ночь работает на старуху и находится у нее “в полном рабстве”. Раскольников оставляет в залог серебряные часы. На обратном пути он заходит в распивочную, где знакомится с Семеном Захаровичем Мармеладовым, спившимся отставным чиновником; тот рассказывает Раскольникову о своей семье. Его жена — Катерина Ивановна, вдова офицера — от первого брака имееттроих детей. После смерти мужа-картежника она осталась без всяких средств к существованию и от безнадежности вышла замуж за Мармела-дова, чиновника, который вскоре потерял место, запил и пьет до сих пор. Дочь Мармеладова от первого брака Соня вынуждена была пойти на панель, потому что нечем было кормить детей Катерины Ивановны. Мармеладов выпрашивает деньги у дочери, ворует последнее у жены. При этом любит заниматься самобичеванием на публике с биением себя в грудь и пьяными рыданиями. Раскольников отводит пьяницу домой, там поднимается скандал. Раскольников уходит, незаметно оставив на подоконнике несколько монет. Наутро он получает письмо от матери, которая объясняет ему, почему не могла прежде прислать ему денег — она сама и сестра Раскольникова Дуня, стараясь обеспечить его необходимым, залезли в большие долги. Дуне пришлось поступить в услужение к господам Свидригайловым и взять вперед сто рублей вознаграждения, чтобы послать брату Родиону. По этой причине, когда Свидригайлов начал домогаться Дуни, она не могла сразу уйти оттуда. Жена Свидригайлова — Марфа Петровна — по ошибке обвинила во всем Дуню и изгнала из дома, опозорив на весь город. Но тут в Свидригайлове проснулась совесть, и он отдает жене письмо Дуни, в котором она с гневом отвергает его домогательства и заступается за его жену. Марфа Петровна объезжает все городские дома, восстанавливая репутацию девушки. Для Дуни находится и жених — надворный советник Петр Петрович Лужин, который вот-вот приедет по делам в Петербург. Читая письмо матери, которая тщетно старается обнаружить хоть какие-нибудь положительные качества у человека, за которого согласилась выйти замуж Дуня, Раскольников понимает, что сестра его продает себя, чтобы помочь ему закончить учебу и устроиться (на это она надеется) в адвокатскую контору, которую собирается открыть в Петербурге ее будущий муж. Мать называет Лужина человеком прямодушным, приводя в пример его слова о том, что он желает жениться на девушке честной, но непременно бедной и пережившей беду, потому что, по его мнению, муж ничем не должен быть обязан своей жене, напротив, жена должна видеть в муже своего благодетеля.  Возмущенный Родион решает не допустить этого брака. Он считает: то, что собирается сделать Дуня, еще хуже, чем поступок Сони Мармеладовой, которая просто спасает детей от голодной смерти. В конце письма мать сообщает, что на днях вышлет сыну денег, а скоро и они с Дуней сами приедут в Петербург. Раскольников выходит из дома и бродит по городу, разговаривая сам с собой. Он понимает, что пока он закончит учебу и устроится на работу, пройдут годы, а что станется за это время с матерью и сестрой? И снова его посещает мысль о процентщице. Вдруг он замечает бредущую по бульвару пьяную, растерзанную девушку, почти девочку, к которой собирается подойти, явно с грязными намерениями, какой-то жирный господин. Раскольников прогоняет его и зовет городового, которому дает денег на извозчика, чтобы отвез девушку домой. Ее явно обманули, напоили, обесчестили и выкинули на улицу. Раскольников с сочувствием размышляет о дальнейшей судьбе девушки, понимая при этом, что ничего поделать не может — какой-то “процент” оказывается на этом пути. Раскольников ловит себя на том, что, выходя из дома, собирался идти к своему университетскому 374 товарищу Разумихину, у которого не был уже месяца четыре. Неожиданно для себя он решает пойти к нему не сейчас, а “после того, когда уже то будет кончено...”. Собственное решение приводит Родиона в ужас. Он идет куда глаза глядят, долго бродит, потом поворачивает к дому и в полном изнеможении сходит с дороги, падает на траву и засыпает. Ему снится страшный сон: он, мальчик лет семи, идет с отцом по дороге к кладбищу мимо кабака, около которого стоит ломовая лошадь, запряженная в телегу. Из кабака выходит пьяный хозяин лошади — Миколка с приятелями. Все садятся в телегу, но лошадь старая, у нее нет сил сдвинуть телегу с места. Миколка немилосердно хлещет лошадь кнутом, к избиению присоединяются остальные. Они забивают лошадь до смерти. Раскольников (маленький мальчик) с криком подбегает к лошади, целует ее мертвую морду, потом бросается в исступлении на Миколку. Отец хватает его и уносит. Раскольников, проснувшись, размышляет: неужели он в самом деле возьмет топор и станет бить по голове?.. Нет, он на это неспособен, он “этого не вытерпит”. От этой мысли у него становится легко на душе. Но тут происходит неожиданная встреча, возвращающая его к старому плану. Он наталкивается на сестру процентщицы Лизавету — та договаривается со знакомыми прийти завтра к ним по какому-то делу. Это означает, что завтра вечером старуха останется дома одна. Раскольников чувствует, что “нет у него более ни свободы рассудка, ни воли и что всё вдруг решено окончательно”. Еще месяца полтора назад Раскольников, направляясь к старухе-процентщице с колечком, под которое хотел занять денег, по дороге зашел в трактир и там услышал разговор офицера со студентом об этой самой старухе и ее сводной сестре. Студент говорил, что Лизавета очень добрая и кроткая, а старуха по своему завещанию не собирается ей оставлять ни гроша. “Я бы эту старуху убил и ограбил... без всякого зазору совести, — добавил он. Столько людей пропадает без поддержки, сколько доброго можно сделать на старухины деньги! Что значит на общих весах жизнь этой... злой старушонки?” Однако когда офицер спросил собеседника, сможет ли он сам убить старуху, тот ответил “нет”. Тот трактирный разговор сильно подействовал на Раскольникова.  Родион идет домой и ложится спать. Назавтра он просыпается поздно и никак не может собраться с мыслями. День между тем уже клонился к вечеру. “И необыкновенная и какая-то растерявшаяся суета охватила его вдруг, вместо сна и отупения”. Он быстро готовится к убийству: пришивает изнутри к пальто петлю для топора, заворачивает в бумагу и завязывает тесемкой фальшивый “заклад” — дощечку и железку, — чтобы отвлечь внимание старухи, и осторожно спускается по лестнице, крадет в дворницкой топор и “степенно, не торопясь”, чтобы не вызывать подозрений, идет к дому процентщицы. Поднимаясь по лестнице, Раскольников замечает, что квартира на третьем этаже, как раз под квартирой старухи, тоже пустует — там идет ремонт. Он звонит в дверь, старуха открывает ему. Стараясь развязать тесемку на “закладе”, она поворачивается спиной к Рас-кольникову, и тот бьет ее обухом по голове, потом еще и еще. Осторожно достав у мертвой старухи из кармана ключи, он принимается шарить по сундукам, запихивая чужие заклады и деньги по карманам. Его руки дрожат, ключи никак не попадают в замки, ему хочется бросить все и уйти. В соседней комнате раздается шум, Раскольников, схватив топор, бежит туда и сталкивается с внезапно пришедшей Лизаветой, которая увидела его, и “губы ее перекосились, как у маленьких детей...”. Несчастная Лизавета была так забита, что даже руки не поднимает, чтобы защититься. Раскольников убивает ее. Потом смывает кровь с рук и топора. Его охватывает оцепенение. Он встряхивается, приказывая себе бежать. И тут замечает, что входная дверь незаперта. Он запирает ее на засов. Но ведь надо уходить! Он снова открывает дверь и стоит, прислушиваясь. Кто-то поднима- ется по лестнице. Вот уже он миновал третий этаж. Только тут Раскольников бросается назад в квартиру и запирает дверь. Звонит не переставая дверной колокольчик. К посетителю за дверью подошел еще кто-то. Оба посетителя в недоумении переговариваются — ведь старуха никогда не выходит из дома! Надо послать за дворником. Один спускается вниз, второй, подождав немного, тоже уходит. Раскольников выходит из квартиры, прячется в пустой квартире на третьем этаже, пока давешние посетители с дворником поднимаются по лестнице на четвертый этаж, и выбегает из дома на улицу. Он умирает от страха и с трудом соображает, что делать дальше. Подойдя к своему дому, вспоминает о топоре, кладет его на место в дворницкой, где снова никого не оказалось. Наконец Раскольников в своей комнате. Оя без сил бросается на диван. Раскольников просыпается рано утром. Его бьет нервный озноб. Он тщательно осматривает одежду, уничтожая следы крови. Потом вдруг вспоминает о награбленных вещах и судорожно прячет их за оторвавшиеся обои. Его лихорадит и клонит в сон, он то и дело засыпает. Окончательно будит его сильный стук в дверь — принесли повестку из полиции. Раскольников выходит из дома и окунается в невыносимую жару. “Если спросят, я, может быть, и скажу”, — думает он. “Войду, стану на колени и всё расскажу...” — решает Раскольников, подходя к конторе квартального надзирателя. Оказалось, что его вызвали по делу о взыскании с него долга квартирной хозяйке. Раскольников, слушая объяснения письмоводителя, чувствует, как спадает давившая на него тяжесть, его наполняет животная радость. В эту минуту в конторе поднимается гам: помощник квартального набрасывается с руганью на сидящую в прихожей пышную даму, содержательницу публичного дома Луизу Ивановну. Раскольников в истерическом оживлении начинает рассказывать письмоводителю о своей жизни, родственниках, о том, что он собирался жениться на дочери квартирной хозяйки, но она умерла от тифа. Его обрывают, приказывают писать обязательство, что он заплатит долг и т. п. Он пишет, отдает, может уходить, но не уходит. У него появляется мысль рассказать про преступление. И тут Раскольников слышит разговор об убийстве старухи и Лизаветы. Он порывается уйти, но теряет сознание. Очнувшись, Раскольников говорит полицейским, глядящим на него с некоторым подозрением, что болен. Его отпускают, он спешит домой — надо избавиться от вещей. Он хочет бросить их в воду, но кругом люди. Наконец он прячет вещи под камень в глухом, пустынном дворе. Ноги сами несут Раскольникова к Разумихину. Он говорит ему что-то невнятное, отказывается от помощи и уходит. На улице он чуть было не попадает под экипаж, его принимают за нищего, суют двадцать копеек. Он останавливается на мосту через Неву, где любил стоять в прежние времена, долго смотрит на панораму города и бросает монету в воду. “Ему показалось, что он как будто ножницами отрезал себя сам от всех и всего в эту минуту”. После долгих блужданий Раскольников возвращается домой и забывается в полусне, который прерывается бредом: ему слышатся ужасные крики хозяйки, которую избивает помощник квартального надзирателя. Он в ужасе ждет, что сейчас придут за ним. Появившаяся кухарка Настасья, жалеющая и подкармливающая Раскольникова, говорит, что ему померещилось. Раскольников теряет сознание. Очнувшись на четвертый день, он видит в своей каморке Разумихина и кухарку Настасью, которые ухаживали за ним. Раскольникову приносят присланные матерью тридцать пять рублей. Разумихин уладил дело с долгом, по которому Раскольникова вызывали в полицию. На полученные деньги он покупает Раскольникову новую одежду. К Раскольникову приходит приятель Разумихина, студент-медик Зосимов. Приятели разговаривают о своем: завтра у Разумихина новоселье, среди гостей будет местный следователь Порфирий Петрович; в убийстве старухи-процентщицы и Лизаветы обвинен маляр Миколай, работавший в доме, где произошло убийство, — он нашел в ремонтируемой квартире коробочку с золотыми серьгами и пытался их заложить у содержателя распивочной. Зосимов и Разумихин рассуждают о деталях дела. Разумихин восстанавливает картину убийства: Кох и Пестряков, пришедшие к процентщице, застали убийцу в квартире, когда же они спустились за дворником, убийца спрятался этажом ниже, откуда только что выбежали дурачившиеся маляры. Там убийца и выронил футляр. Когда все поднялись в квартиру старухи, убийца незаметно вышел. Разговор прерывается появлением немолодого, осанистого господина с брюзгливой физиономией. Это Петр Петрович Лужин — жених Дуни. Он сообщает Раскольникову, что его мать и сестра вот-вот приедут и остановятся в номерах (самого низкого пошиба) за его счет. Лужин купил уже и постоянную квартиру для себя и Дуни, но ее сейчас отделывают. Сам он остановился неподалеку у своего молодого друга Андрея Семеновича Лебезятникова. Лужин заводит разговор о молодежи, о новых веяниях, за которыми он неустанно следит, об экономической науке, которая приходит к выводу, что чем больше в обществе устроенных частных дел, тем лучше устроено и общее дело. Другими словами — возлюби прежде всего самого себя, ведь что такое “возлюби ближнего своего”? — это значит разорви свой кафтан, отдай ему половину и оба окажетесь полуодеты. Разумихин обрывает разглагольствования Лужина. Зосимов и Разумихин возвращаются к убийству. Первый считает, что старуху наверняка убил кто-то из тех, кому она ссужала деньги. Второй с ним согласен, сообщает, что следователь Порфирий Петрович как раз их и допрашивает. Лужин, вмешавшись в разговор, начинает разглагольствовать о росте преступности не только в нижних слоях общества, но и в высших. В разговор вмешивается Раскольников. По его мнению, причина этого кроется именно в теории господина Лужина — если ее довести до конца, так выходит, что и людей резать можно. Раскольников требует у Лужина ответить — правда ли, что он больше всего рад тому, что его невеста нищая, потому что выгоднее жениться на нищей, чтобы потом над ней властвовать. Он прогоняет Лужина. Когда все уходят, Раскольников одевается и идет бродить по городу. Он оказывается в переулке, где находятся “весьма увеселительные заведения”. В голову ему приходит мысль о приговоренных к смерти, которые готовы жить на скале, на узенькой площадке, только чтобы их оставили в живых. “Подлец человек! — думает Раскольников. — И подлец тот, кто его за это подлецом называет”. Он заходит в трактир, просит подать газеты. К нему подходит Заметов — письмоводитель из полицейского участка, приятель Разумихина, который приводил его к Раскольникову, когда тот был без сознания. Ему кажется странной лихорадочная возбужденность Раскольни-кова, в процессе разговора с ним у Заметова рождается подозрение. Они разговаривают о фальшивомонетчиках. Раскольников рассказывает, как бы он сам действовал на их месте потом — что бы сделал с вещами старухи, если б ее убил. Он действительно рассказывает о том месте, где их спрятал. И вдруг спрашивает Заметова: “А что, если это я старуху и Лизавету убил?.. Признайтесь, что вы бы поверили? Да?” Раскольников уходит в состоянии полного нервного изнеможения. Заметов приходит к выводу, что подозрения его беспочвенны. В дверях Раскольников сталкивается с Разумихи-ным. Тот требует сказать, что с ним происходит, приглашает его на новоселье. Раскольников отказывается, просит оставить его в покое.  Он останавливается на мосту, смотрит на воду, на город. Вдруг неподалеку бросается в реку какая-то женщина. Городовой ее вытаскивает. Отбросив мимолетную мысль о самоубийстве, Раскольников направляетсявк полицейскому участку, но вскоре оказывается у дома, где совершил убийство. Он входит в дом, заговаривает с рабочими, ремонтирующими квартиру убитой старухи, спрашивает их про кровь, потом разговаривает с дворником, кажется всем им подозрительным. Раскольников размышляет, идти ли ему к квартальному надзирателю, но тут видит человека, попавшего под копыта лошадей. Он узнает Мармеладова. Чувствуя облегчение оттого, что откладывается его визит в полицейский участок, Раскольников хлопочет о раненом. Мармеладова несут домой. Там его жена Катерина Ивановна и трое ее детей. Мармеладов при смерти, посылают за священником и Соней. Умирающий просит прощения у Сони. Раскольников отдает Катерине Ивановне все свои деньги (из присланных ему матерью) и уходит. Дочь Катерины Ивановны Полинька догоняет его, чтобы поблагодарить. Раскольников просит девочку помолиться за него, дает ей свой адрес и обещает прийти еще. Он чувствует прилив сил и уверенность в том, что и ему “можно жить, что есть еще жизнь, что не умерла его жизнь со старою старухой”. Раскольников идет к Разумихину, вызывает его в прихожую. Разуми-хин провожает его домой, по дороге говорит, что, по мнению Зосимова, его приятель сумасшедший, что Заметов раскаивается в своих подозрениях насчет Раскольникова, что он и Порфирий Петрович очень ждали его прихода. В каморке Раскольникова горит свет — его ждут уже три часа мать и сестра. Раскольников падает в обморок. Очнувшись, Раскольников объявляет, что выгнал Лужина, требует от Дуни, чтобы она ему отказала. Он не принимает ее жертвы. “Или я, или Лужин!” — говорит Родион. Разумихин успокаивает его мать и сестру, объясняя все его нездоровьем, просит их уйти, а он будет ухаживать за больным и сообщать им о его состоянии. Он с первого взгляда влюбляется в Дуню, полон восторга, сначала даже пугает ее своей эксцентричностью. “Он соглядатай и спекулянт... он дурак, — говорит он Дуне о ее женихе. — Ну, пара ли он вам?” Дуня проникается полным доверием к Разумихину, успокаивает расстроенную мать. Разумихин провожает мать и сестру Раскольникова в гостиницу, идет к Раскольникову, оттуда снова к Дуне и ее матери, приведя с собой и медика Зосимова. Тот говорит женщинам, что у Раскольникова есть признаки мономании, но их приезд поможет ему. Проснувшись утром, Разумихин ругает себя за вчерашнее поведение — ведь он был после новоселья, нетрезв. Он тщательно одевается и идет в гостиниду, где рассказывает матери и сестре Раскольникова, какие события последнего года привели, по мнению Разумихина, Родиона к заболеванию. Мать Раскольникова говорит, что Лужин не встретил ее и Дуню на вокзале, как обещал, а послал лакея, который и довез их до гостиницы. Сам он должен был прийти сегодня утром, но вместо этого прислал записку. Разумихин читает записку: Лужин пишет, что Родион Романович грубо обидел его, а потому он не хочет его видеть, когда придет к ним вечером. Лужин сообщает также, что видел Родиона “в квартире одного, разбитого лошадьми, пьяницы, от сего умершего, дочери которого, девице отъявленного поведения, выдал вчера до двадцати пяти рублей, под предлогом похорон...”. Дуня решает, что Родион должен прийти к ним. Но сначала они идут к Родиону и застают у него Зосимова. Родион бледен и угрюм”. Он рассказывает о Мармеладове, о его вдове, о детях, о Соне, о том, почему он отдал им деньги. Мать Родиона — Пульхерия Александровна — говорит о скоропостижной смерти жены Свидригайлова Марфы Петровны, по слухам, от мужниных побоев. Раскольников вспоминает покойную дочь квартирной хозяйки, на которой собирался жениться, потом снова заговаривает о женихе Дуни. “Или я, или Лужин”, — повторяет он. Дуня говорит ему в ответ, что не выйдет замуж за Лужина, если он не достоин уважения, а достоин он его или нет — станет ясно сегодня вечером. Дуня показывает брату письмо жениха и просит его присутствовать обязательно при их встрече. Неожиданно в комнату входит Соня Мармеладова. Она приглашает Раскольникова на отпевание и поминки. Он обещает прийти и знакомит Соню со своей матерью и сестрой. Дуня и Пульхерия Александровна уходят, пригласив Разумихина к себе на обед. Раскольников рассказывает Разумихину, что у убитой старухи был и его заклад — часы, доставшиеся от отца, и колечко, подарок Дуни. Он боится, как бы они не пропали. Не обратиться ли ему к Порфирию Петровичу? Разумихин отвечает, что, конечно, обратиться, он будет рад познакомиться с Родионом. Все трое выходят из дома. Раскольников просит у Сони Мармеладовой ее адрес, и она уходит в ужасе, что он увидит, как она живет. Между тем за ней следит какой-то хорошо одетый господин. Он незаметно провожает Соню до самых дверей ее комнаты и там заговаривает с ней. Они, оказывается, соседи — он живет неподалеку, недавно приехал в город. Разумихин и Раскольников идут к Порфирию. У Раскольникова бьется в мозгу одна мысль: “Важнее всего, знает Порфирий или не знает, что я вчера... в квартире был... и про кровь спрашивал? В один миг надо это узнать, с первого шагу, как войду, по лицу узнать...” Он придумывает хитрость — заводит шутливый разговор с\'Разумихиным, намекая на его отношение к Дуне. Тот конфузится, Родион хохочет и так, смеясь, входит к Пор-фирию Петровичу. Он все хохочет и хохочет, стараясь, чтобы его смех звучал натурально, а Разумихин вполне искренно сердится и нечаянно задевает стоящий на столике стакан с чаем. Тот падает. “Да зачем же стулья-то ломать, господа, казне ведь убыток!” — весело закричал Порфирий Петрович. Тут Раскольников замечает сидящего в углу Заметова. Это кажется ему подозрительным. Разговор идет о заложенных вещах. Раскольникову кажется, что Порфирий Петрович “знает”. Заговаривают о преступлении как таковом. Разумихин не согласен с социалистами, объясняющими преступление исключительно социальными причинами — якобы стоит придумать нормальное общество, как преступность исчезнет. Порфирий Петрович упоминает статью Раскольникова “О преступлении”, опубликованную в газете. Раскольников не знал о публикации, он написал эту статью полгода назад. Статья посвящена психологическому состоянию преступника в процессе преступления. Порфирий Петрович утверждает, что Раскольников в статье намекает на то, что есть люди, которые имеют полное право совершать преступление и для них закон не писан. Это искажение идеи Раскольникова. По его мнению, все неординарные люди, способные сказать что-нибудь новое, непременно должны быть, по природе своей, в той или иной мере преступниками. Люди делятся вообще ва два разряда: на низший (обыкновенный), являющийся материалом для воспроизводства себе подобных, и настоящих людей, то есть тех, кто способен сказать новое слово. Если такому человеку надо, для своей идеи, перешагнуть хотя бы и через труп, через кровь, то он может себе сам, по совести, дать разрешение перешагнуть через кровь. Первый разряд — консервативные люди, склонные к послушанию. Те, кто относится ко второму, все преступают закон, они — разрушители или склонны к тому, в зависимости от способностей. Первый разряд — господин настоящего, второй — господин будущего. Первые сохраняют человечество и приумножают его численно, а вторые двигают его и ведут к цели. Порфирий Петрович интересуется: “Чем же... отличить этих необыкновенных от обыкновенных?” Раскольников считает, что ошибиться могут только люди первого разряда. Многие их них искренне считаю себя передовыми людьми, “разрушителями”. Действительно же новых людей они часто не замечают и даже презирают. Но таких новых людей рождается очень мало. Разумихин возмущен тем, что Раскольников считает, что человек может сам себе позволить пролить кровь. По мнению Разумихина, это “разрешение крови по совести... страшнее, чем официальное разрешение кровь проливать, законное...”. Порфирий Петрович спрашивает: а что, если какой-нибудь обыкновенный юноша вообразит себя Ликургом или Магометом и примется устранять все препятствия? И Раскольников, когда писал свою статью, неужели не считал себя, хоть капельку, тоже человеком “необыкновенным” и говорящим новое слово? “Очень может быть”, — отвечает Раскольников. Неужели Раскольников из-за каких-нибудь неудач или еще чего-либо ради всего человечества тоже решился бы убить и ограбить? — не отстает Порфирий Петрович и подмигивает Раскольникову. “Если я и перешагнул, то уж, конечно бы, вам не сказал” — отвечает Раскольников и прибавляет, что Магометом или Наполеоном он себя не считает. “Кто ж у нас на Руси себя Наполеоном теперь не считает?” —возражает Порфирий Петрович. “Уж не Наполеон ли какой будущий и нашу Алену Ивановну на прошлой неделе топором укокошил?” — говорит вдруг Заметов. Мрачный Раскольников собирается уходить, договаривается со следователем, что зайдет к нему завтра. Порфирий Петрович напоследок пытается запутать своими вопросами Раскольникова, якобы перепутав день убийства с тем днем, когда Раскольников относил часы ростовщице. Раскольников и Разумихин идут к Пульхерии Александровне и Дуне. Разумихин возмущен тем, что Порфирий Петрович и Заметов подозревают в убийстве Раскольникова. Уже при подходе к гостинице Раскольникову приходит в голову тревожная мысль. Он быстро идет домой, запирает дверь и тщательно обшаривает дыру за обоями — не осталось ли там чего. Ничего нет. Он выходит во двор и видит: дворник указывает рукой на него какому-то по-мещански одетому человеку. Раскольников подходит к дворнику. Мещанин молча удаляется. Раскольников догоняет его и спрашивает, что все это значит. Человек поднимает на него глаза и говорит тихо и отчетливо: “Убивец!” Раскольников не отстает от незнакомца; тот снова называет его убийцей. Раскольников застывает на месте; на дрожащих ногах он возвращается в свою каморку и ложится. Мысли его путаются. Очнувшись, он размышляет, что за человек это был. Он презирает себя за слабость, он должен был заранее знать, как ему будет тяжело. “Старушонка вздор! ...не в ней дело! ...Я переступить поскорее хотел... я не человека убил, я принцип убил! ... А переступить-то не переступил, на этой стороне остался... Только и сумел, что убить. ...Эстетическая я вошь, и-больше ничего...” — думает Раскольников. Он был обязан заранее знать, что с ним будет после преступления... да он и знал это! Те, другие люди, сделаны не так, как он: “настоящий властелин... громит Тулон, делает резню в Париже, забывает армию в Египте, тратит полмиллиона людей в московском походе...”, и ему же после смерти ставят памятники. Значит, им все разрешается. А ему нет. Он хотел помочь матери и сестре, целый месяц убеждал себя, что идет на преступление ради благой цели, жертвой выбрал самую гадкую старуху, и что же? Он мучается и презирает себя: так ему и надо. Если он “тварь дрожащая”, то его удел — повиноваться и не желать большего, не его это дело. В душе Раскольникова поднимается ненависть ко всем и одновременно любовь к “бедным, кротким, милым” — к Лизавете, которую он убил, к матери, к Соне... Он понимает, что в какую-то минуту “с него станется” рассказать все матери... Раскольников засыпает и видит страшный сон: мещанин заманивает его в квартиру старухи, а та, живая, прячется там в углу. Он снова бьет ее топором — а она смеется. Он бросается бежать — а его уже поджидают люди. Раскольников в ужасе просыпается и видит на пороге незнакомца. Это Аркадий Иванович Свидригайлов. Свидригайлов говорит, что ему нужна помощь Раскольникова в одном деле, касающемся его сестры. Одного-то его она и на порог к себе не пустит, а вместе с братом... Раскольников отказывает Свидригайлову. Тот свое гнусное поведение по отношению к Дуне объясняет влюбленностью, страстью.  Раскольников говорит, что слыхал, будто Свидригайлов погубил свою жену, на что тот отвечает, что умерла Марфа Петровна от апоплексического удара, а он ее “ударил всего только два раза хлыстиком”. Свидригайлов говорит не умолкая. Раскольников, приглядевшись к нему, замечает: “Мне... кажется, что вы очень хорошего общества, по крайней мере, умеете при случае быть и порядочным человеком”. “...Я ничьим мнением особо не интересуюсь, — отвечает Свидригайлов, — а потому отчего же и не побывать пошляком.... особенно если к тому и натуральную склонность имеешь”. Свидригайлов рассказывает историю своей женитьбы на Марфе Петровне. Она выкупила его из тюрьмы, куда он попал за долги, женила на себе и увезла в деревню. Она его очень любила. Документ об уплаченных тридцати тысячах она хранила всю жизнь как залог того, что муж ее не бросит, и лишь за год до смерти вернула его ему и подарила приличную сумму денег. Свидри-гайлову является покойная Марфа Петровна. Раскольников поражен — ему ведь тоже явилась во сне убитая им старуха. “Отчего я так и думал, что с вами непременно что-нибудь в этом роде случается!” — восклицает он. Свидригайлов обрадован: он чувствовал, что между ними есть что-то общее, он, как увидел Раскольникова, сразу подумал: “Это тот самый и есть!” На вопрос: “Какой — тот самый?” — он ответить не может. Раскольников советует Свидригайлову сходить к врачу, считает его “помешанным”. Свидригайлов заявляет, что Лужин не пара сестре Раскольникова и что он готов предложить Дуне десять тысяч рублей, чтобы облегчить ей разрыв с женихом. У него и ссора-то с Марфой Петровной вышла из-за того, что она “состряпала эту свадьбу”. Марфа Петровна завещала Дуне три тысячи. Перед своим возможным “вояжем” Свидригайлов хочет “покончить с господином Лужиным” и повидаться с Дуней. К тому же он собирается скоро жениться “на одной девице”. Уходя, Свидригайлов сталкивается в дверях с Разумихиным. К восьми часам Раскольников с приятелем идет в гостиницу к матери и сестре. В коридоре они сталкиваются с Лужиным. Все входят в комнату. Лужин сердит — нарушено его приказание не пускать Родиона. Пульхерия Александровна, стараясь поддерживать разговор, упоминает о кончине Марфы Петровны. Лужин сообщает о приезде Свидригайлова и рассказывает о преступлении этого человека, о котором он якобы знает со слов покойной. Свидригайлов водил знакомство с некоей Ресслих, процентщицей, а у нее жила ее племянница, глухонемая девочка четырнадцати лет, которую она попрекала каждым куском и била. Однажды девочка была найдена на чердаке повесившейся. Поступил донос — девочка была “жестоко оскорблена” Свидригайловым. Благодаря стараниям и деньгам Марфы Петровны дело было замято. Лужин упоминает и еще об одном преступлении Свидригайлова — еще во время крепостного права он замучил, довел до самоубийства своего слугу Филиппа. Дуня возражает Лужину, говорит, что Свидригайлов хорошо обращался со слугами. Раскольников сообщает о визите Свидригайлова, о том, что он просит о свидании с Дуней и что Марфа Петровна оставила Дуне по завещанию деньги.";
        }
     
    }

}
